<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/fonte.css">


    <title>Registro de Ocorrência de Trem</title>
</head>

<style>
    .custom-title {
      color: #F20505; 
      text-align: center;
    }
  
    .btn-red {
            background-color: #ff0000; 
            border-color: #ff0000; 
    }

    .btn-red:hover {
    background-color: #f97e7e; 
    border-color: #f97e7e; 
    }

</style> 



<body>
    <header>
         <%- include ('navbar') %> 
    </header>

    <main class="container mt-5">
        <div class="text-center"> 
            <h1 class="display-2 custom-title">Ocorrência de trem</h1>
        </div>

       
        <form id="ocoTrensForm" action="/ocoTrens" method="post">

            <div class="d-flex align-items-center justify-content-center vh-20">
                <div class="form-floating mb-3 w-50">
                    <input type="date" class="form-control" id="data" name="data" required><br>
                    <label for="data" class="form-label">Data:</label>
                </div>        
            </div>

            <div class="d-flex align-items-center justify-content-center vh-20"> 
                <div class="form-floating mb-3 w-50"> 
                    <input type="time" class="form-control" id="horario" name="horario" required>
                    <label for="horario" class="form-label">Horário:</label>
                </div>
            </div>

            <div class="d-flex align-items-center justify-content-center vh-20">
                <div class="form-floating mb-3 w-50">
                    <input type="text" class="form-control" id="codigo_trem" name="codigo_trem" required>
                    <label for="codigo_trem" class="form-label">Código do trem:</label>
                </div>
            </div>

            <div class="d-flex align-items-center justify-content-center vh-20"> 
                <div class="form-floating mb-3 w-50">
                    <select name="linha" id="linha" class="form-select" required>
                        <option value=""></option>
                        <option value="linha-7">Linha-7</option>
                        <option value="linha-10">Linha-10</option>
                        <option value="linha-11">Linha-11</option>
                        <option value="linha-12">Linha-12</option>
                        <option value="linha-13">Linha-13</option>
                    </select>
                    <label for="linha" class="form-label">Linha:</label>
                </div>
            </div>

            
            <div class="d-flex align-items-center justify-content-center vh-20">
                <div class="form-floating mb-3 w-50" >
                    <input type="text" class="form-control" id="bloco" name="bloco" required>
                    <label for="bloco" class="form-label">Bloco:</label>
                </div>
            </div>

            <div class="d-flex align-items-center justify-content-center vh-20"> 
                    <input type="checkbox" class="form-check-input" id="Inviabilizou_o_bloco" name="Inviabilizou_o_bloco" value="on">
                    <label for="Inviabilizou_o_bloco" class="form-check-label">Inviabilizou o bloco:</label>
                </div>
            </div>

            <div class="d-flex align-items-center justify-content-center vh-20"> 
                    <input type="checkbox" class="form-check-input" id="Impacto_na_velocidade" name="Impacto_na_velocidade" value="on">
                    <label class="form-check-label">Impacto na velocidade:</label>
                </div>
            </div>

            <div class="d-flex align-items-center justify-content-center vh-20"> 
                <div class="form-floating mb-3 w-50">
                    <select name="Categoria" id="Categoria" class="form-select" required>
                        <option value=""></option>
                        <option value="Lotação excessiva">Lotação excessiva</option>
                        <option value="Falha na sinalização">Falha na sinalização</option>
                        <option value="Queda de energia">Queda de energia</option>
                        <option value="Emergencia">Emergência</option>
                        <option value="Quebra">Quebra</option>
                        <option value="Outro">Outro</option>
                    </select>
                    <label for="Categoria" class="form-label">Categoria:</label>
                </div>
            </div>

            
            <div class="d-flex align-items-center justify-content-center vh-20" >
                <div class="form-floating mb-3 w-50">
                    <textarea id="descricao" class="form-control" name="descricao" rows="4"></textarea>
                    <label for="descricao" class="form-label">Descrição:</label>
                </div>
            </div>

            <form action="/index" method="get">
                <div class="text-center">
                    <h1 class="display-3"> 
                        <a href="/" class="btn btn-primary btn-red">Voltar</a>
                        <button type="submit" class="btn btn-secondary me-2 btn-red">Enviar</button>
                    </h1>
                </div>
            </form>
            <div id="successMessage" class="alert alert-success mt-4" style="display: none;">
                Ocorrência registrada com sucesso!
            </div>


       
    </main>
    <footer>
        <%- include ('footer') %> 
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("ocoTrensForm");
            const successMessage = document.getElementById("successMessage");
      
            form.addEventListener("submit", function (event) {
                event.preventDefault(); // Evita o envio do formulário
    
                // Cria um objeto com os dados do formulário
                const formData = {
                    data: document.getElementById("data").value,
                    horario: document.getElementById("horario").value,
                    codigo_trem: document.getElementById("codigo_trem").value,
                    linha: document.getElementById("linha").value,
                    bloco: document.getElementById("bloco").value,
                    Inviabilizou_o_bloco: document.getElementById("Inviabilizou_o_bloco").checked,
                    Impacto_na_velocidade: document.getElementById("Impacto_na_velocidade").checked,
                    Categoria: document.getElementById("Categoria").value,
                    descricao: document.getElementById("descricao").value
                };
    
                // Envia os dados como JSON
                fetch('/ocoTrens', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.text())
                .then(text => {
                    console.log('Formulário enviado com sucesso:', text);
                    // Exibe a mensagem de sucesso
                    successMessage.style.display = "block";
                    // Limpa os campos do formulário
                    form.reset();
                    // Oculta a mensagem de sucesso após alguns segundos (opcional)
                    setTimeout(function () {
                        successMessage.style.display = "none";
                    }, 5000); // Oculta após 5 segundos
                })
                .catch(err => console.error('Erro ao enviar formulário:', err));
            });
        });
    </script>
    

</body>
</html>
